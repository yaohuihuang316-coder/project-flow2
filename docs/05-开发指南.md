# 开发指南

## 开发环境配置

### 安装依赖
```bash
npm install
```

### 启动开发服务器
```bash
npm run dev
```

### 代码检查
```bash
# TypeScript 检查
npx tsc --noEmit

# 构建测试
npm run build
```

## 项目结构

```
project-flow2/
├── docs/                 # 文档目录
├── pages/                # 页面组件
│   ├── Dashboard.tsx
│   ├── LearningHub.tsx
│   ├── Profile.tsx
│   └── ...
├── components/           # 公共组件
│   ├── Navbar.tsx
│   ├── MobileTabbar.tsx
│   └── ...
├── tools/                # 工具组件
│   ├── MonteCarloSimulator.tsx
│   ├── CCPMSchedule.tsx
│   └── ...
├── lib/                  # 工具函数
│   ├── supabaseClient.ts
│   ├── membership.ts
│   └── kimiService.ts
├── types.ts              # TypeScript 类型
├── App.tsx               # 主应用
└── ...
```

## 代码规范

### 组件命名
- 使用 PascalCase
- 功能组件以功能命名
- 页面组件放在 pages 目录

```typescript
// 正确
const UserProfile: React.FC<Props> = () => { }
const KnowledgeGraphV2: React.FC<Props> = () => { }

// 错误
const userProfile = () => { }
const knowledge_graph = () => { }
```

### 类型定义
```typescript
// 接口命名使用大驼峰
interface UserProfile {
  id: string;
  name: string;
  email: string;
}

// 类型别名使用大驼峰
type MembershipTier = 'free' | 'pro' | 'pro_plus';
```

### 样式规范
- 使用 Tailwind CSS
- 响应式类名：`sm: md: lg:`
- 颜色使用 Tailwind 预设

```tsx
<div className="flex items-center gap-4 p-4 bg-white rounded-xl shadow-sm">
```

## 数据库操作

### 查询数据
```typescript
const { data, error } = await supabase
  .from('app_courses')
  .select('*')
  .eq('is_published', true);
```

### 插入数据
```typescript
const { data, error } = await supabase
  .from('app_user_progress')
  .insert({
    user_id: currentUser.id,
    course_id: courseId,
    progress: 0
  });
```

### 更新数据
```typescript
const { data, error } = await supabase
  .from('app_user_progress')
  .update({ progress: 50 })
  .eq('user_id', userId)
  .eq('course_id', courseId);
```

## 添加新工具

1. 在 `tools/` 目录创建组件
2. 在 `pages/ToolsLab.tsx` 注册工具
3. 添加工具配置信息

```typescript
// tools/NewTool.tsx
const NewTool: React.FC = () => {
  return <div>新工具内容</div>;
};

// pages/ToolsLab.tsx
const toolComponents = {
  'new-tool': <NewTool />,
  // ...
};
```

## 添加新页面

1. 在 `pages/` 创建页面组件
2. 在 `types.ts` 添加 Page 枚举
3. 在 `App.tsx` 添加路由逻辑

```typescript
// types.ts
enum Page {
  NEW_PAGE = 'new_page',
}

// App.tsx
{currentPage === Page.NEW_PAGE && <NewPage />}
```

## 调试技巧

### React DevTools
- 安装浏览器扩展
- 检查组件层级
- 查看 Props 和 State

### Supabase 调试
- 查看 SQL 日志
- 检查 RLS 策略
- 测试 API 调用

### 常见错误

#### TypeScript 错误
```bash
# 检查所有类型错误
npx tsc --noEmit
```

#### 构建错误
```bash
# 查看详细错误信息
npm run build 2>&1
```

#### 运行时错误
- 检查浏览器控制台
- 查看网络请求
- 确认环境变量

## 提交规范

```
feat: 添加新功能
fix: 修复bug
docs: 更新文档
style: 样式调整
refactor: 代码重构
chore: 构建/工具
```

示例：
```bash
git commit -m "feat: 添加知识图谱V2功能"
git commit -m "fix: 修复PDF中文乱码问题"
```
