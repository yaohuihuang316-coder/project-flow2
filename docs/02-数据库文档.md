# 数据库文档

## 核心数据表

### 用户相关

#### app_users
用户基础信息表
```sql
- id: TEXT PRIMARY KEY
- email: TEXT UNIQUE
- name: TEXT
- role: TEXT (Student/Instructor/Admin/SuperAdmin)
- avatar: TEXT
- membership_tier: TEXT (Free/Pro/Pro+)
- xp: INTEGER
- streak: INTEGER
- created_at: TIMESTAMP
```

#### app_user_skills
用户技能评分表（六维雷达图）
```sql
- user_id: TEXT REFERENCES app_users(id)
- plan_score: INTEGER (0-100) 规划能力
- exec_score: INTEGER (0-100) 执行能力
- cost_score: INTEGER (0-100) 成本能力
- risk_score: INTEGER (0-100) 风险能力
- lead_score: INTEGER (0-100) 领导力
- agile_score: INTEGER (0-100) 敏捷能力
```

#### app_learning_activity
学习活动记录表（热力图数据）
```sql
- user_id: TEXT
- activity_date: DATE
- activity_type: TEXT (course/simulation/tool/login)
- xp_earned: INTEGER
- details: JSONB
```

### 学习相关

#### app_courses
课程表
```sql
- id: TEXT PRIMARY KEY
- title: TEXT
- description: TEXT
- category: TEXT
- difficulty: INTEGER (1-5)
- estimated_hours: INTEGER
- is_published: BOOLEAN
```

#### app_course_progress
课程进度表
```sql
- user_id: TEXT
- course_id: TEXT
- progress: INTEGER (0-100)
- status: TEXT (not_started/in_progress/completed)
- last_accessed: TIMESTAMP
```

### 实战模拟

#### app_simulation_scenarios
模拟场景表
```sql
- id: TEXT PRIMARY KEY
- title: TEXT
- description: TEXT
- difficulty: TEXT (Easy/Medium/Hard/Expert)
- category: TEXT
- stages: JSONB
- learning_objectives: JSONB
- estimated_time: INTEGER
```

#### app_simulation_progress
模拟进度表
```sql
- user_id: TEXT
- scenario_id: TEXT
- current_stage: INTEGER
- decisions_made: JSONB
- score: INTEGER
- status: TEXT
```

### 徽章系统

#### app_achievements
徽章定义表
```sql
- id: UUID PRIMARY KEY
- code: TEXT UNIQUE (pmp_master/early_bird等)
- name: TEXT
- description: TEXT
- category: TEXT (learning/skill/social/special)
- unlock_type: TEXT
- rarity: TEXT (common/rare/epic/legendary)
```

#### app_user_achievements
用户徽章记录表
```sql
- user_id: TEXT
- achievement_id: UUID
- unlocked_at: TIMESTAMP
- progress: INTEGER
- is_new: BOOLEAN
```

## 常用 SQL 操作

### 初始化数据库
```bash
# 在 Supabase SQL Editor 中执行
\i db_setup.sql
\i db_profile_features.sql
\i db_demo_data.sql
```

### 插入演示数据
```sql
-- 为演示账号添加学习活动
SELECT record_learning_activity('test-pro-001', 'course', 50, '{"course": "PM基础"}'::jsonb);
```

### 查询用户统计
```sql
-- 用户学习统计
SELECT 
    user_id,
    COUNT(DISTINCT activity_date) as study_days,
    SUM(xp_earned) as total_xp
FROM app_learning_activity
WHERE user_id = 'test-pro-001'
GROUP BY user_id;
```
