# 教师端完整实现计划

> 工作流程：**开发阶段（本地Commit，不部署）→ 多阶段完成 → 手动部署 → 统一验证 → 标记完成**
> 
> ⚠️ **Vercel 自动部署已关闭** - 所有更改将在手动部署时统一上线

---

## 阶段 1：签到码功能重写

### 目标
实现完整的签到码功能闭环：教师生成6位数字签到码 → 学生输入签到码 → 实时显示签到状态

### 任务清单

#### 1.1 数据库结构调整
- [x] 检查 `app_class_sessions` 表是否支持签到码存储
- [x] ~~如需添加字段，创建数据库迁移脚本~~（使用 whiteboard_data 字段）
- [x] 验证 RLS 策略允许更新签到码

#### 1.2 重写生成签到码函数
- [x] 修改 `generateCheckInCode` 函数
- [x] 生成6位随机数字码
- [x] 存储到数据库（使用 `whiteboard_data` 字段）
- [x] 5分钟过期机制
- [x] 本地 Commit: `e75f74c`

#### 1.3 学生端签到功能
- [x] 学生端输入签到码界面（在 Classroom.tsx 添加签到卡片）
- [x] 验证签到码有效性（查询 whiteboard_data 字段）
- [x] 创建签到记录到 `app_attendance`
- [x] 本地 Commit: `30c6ccd`

#### 1.4 实时签到监听
- [x] 优化 `useAttendanceRealtime` Hook（检查现有实现）
- [x] 实时显示学生签到状态（已使用 supabase realtime）
- [x] 签到统计更新

#### 1.5 阶段完成检查（待手动部署后统一验证）
- [x] 代码推送至 GitHub: `c5b0cb8`
- [x] 功能开发完成（教师端+学生端）
- [ ] 手动部署至 Vercel
- [ ] 教师点击"生成签到码"显示6位数字
- [ ] 学生输入签到码成功签到
- [ ] 教师端实时显示签到学生列表
- [ ] 签到统计数据正确

**验证命令:** `node verify-phase1.mjs`（将在统一部署后运行）

**状态:** ✅ 代码开发完成，📦 等待统一部署验证

---

## 阶段 2：UI 自适应修复

### 目标
修复教师端所有页面在移动端和桌面端的自适应问题

### 任务清单

#### 2.1 Classroom.tsx 页面
- [ ] 修复课堂进行中界面移动端布局
- [ ] 修复签到区域在小屏幕下的显示
- [ ] 修复底部导航遮挡内容问题
- [ ] 本地 Commit

#### 2.2 TeacherDashboard.tsx 页面
- [ ] 修复统计卡片在小屏幕下的布局
- [ ] 修复今日课程列表移动端显示
- [ ] 本地 Commit

#### 2.3 TeacherCourses.tsx 页面
- [ ] 修复课程网格布局自适应
- [ ] 修复课程卡片在小屏幕下的高度
- [ ] 本地 Commit

#### 2.4 Assignments.tsx 页面
- [ ] 修复作业列表移动端布局
- [ ] 修复批改界面小屏幕适配
- [ ] 本地 Commit

#### 2.5 阶段完成检查
- [ ] 375px 宽度下所有页面正常显示
- [ ] 768px 宽度下布局正确
- [ ] 1440px 宽度下桌面端布局正常
- [ ] 所有按钮可点击，不被遮挡

**状态：** 🔄 进行中

---

## 阶段 3：后台管理 - 教师数据管理

### 目标
后台可以完整管理教师端产生的所有数据

### 任务清单

#### 3.1 教师账号管理
- [ ] AdminTeachers.tsx 页面
- [ ] 显示所有教师列表
- [ ] 教师状态管理（正常/禁用/待审核）
- [ ] 教师详情查看
- [ ] 本地 Commit

#### 3.2 课堂会话管理
- [ ] AdminClassSessions.tsx 页面
- [ ] 查看所有进行中的课堂
- [ ] 强制结束课堂功能
- [ ] 删除课堂记录
- [ ] 本地 Commit

#### 3.3 签到数据管理
- [ ] AdminAttendance.tsx 页面
- [ ] 查看所有签到记录
- [ ] 按课堂筛选签到数据
- [ ] 导出签到报表（CSV）
- [ ] 本地 Commit

#### 3.4 教师统计数据
- [ ] 教师授课时长统计
- [ ] 教师学生数统计
- [ ] 教师签到率统计
- [ ] 数据可视化图表
- [ ] 本地 Commit

#### 3.5 阶段完成检查
- [ ] 后台可以管理所有教师账号
- [ ] 可以查看和管理所有课堂
- [ ] 可以导出签到数据
- [ ] 统计数据准确显示

**状态：** 待开始

---

## 阶段 4：后台管理 - 公告管理补全

### 目标
后台公告管理连接真实数据，支持完整 CRUD 和定向推送

### 任务清单

#### 4.1 连接真实数据
- [ ] AdminAnnouncements.tsx 连接 `app_announcements` 表
- [ ] 显示公告列表
- [ ] 公告分类筛选
- [ ] 本地 Commit

#### 4.2 公告 CRUD
- [ ] 创建公告功能
- [ ] 编辑公告功能
- [ ] 删除公告功能
- [ ] 发布/草稿状态切换
- [ ] 本地 Commit

#### 4.3 定向推送
- [ ] 按角色推送（学生/教师/全部）
- [ ] 按课程推送
- [ ] 紧急公告置顶
- [ ] 本地 Commit

#### 4.4 前端公告显示
- [ ] 学生端显示公告
- [ ] 教师端显示公告
- [ ] 实时推送通知
- [ ] 本地 Commit

#### 4.5 阶段完成检查
- [ ] 后台可以创建、编辑、删除公告
- [ ] 公告可以定向推送给指定角色
- [ ] 学生端/教师端实时显示公告
- [ ] 公告状态（已读/未读）正确显示

**状态：** 待开始

---

## 执行记录

| 日期 | 阶段 | 操作 | 结果 |
|------|------|------|------|
| 2026-02-17 | 阶段1 | 查看计划 | 明确签到码功能目标 |

---

## 流程图说明

```
开始 → 查看计划 → 开发阶段(编码+本地Commit，不部署) → [阶段完成了吗?]
                                               ↓否
是 ← 阶段完成 ← 自主调试 ← 保留截图 ← 验证失败 ← 否 ← [验证通过?]
↓是                                                ↓是
部署到服务器 → 登录网页验证 → 截图记录 → [验证通过?] → 是 → 删除截图 → 标记完成 → 下一阶段
```

**关键规则：**
1. 开发阶段只本地 Commit，不部署
2. 阶段完成后才部署
3. 验证失败保留截图分析
4. 失败超过3次求助用户
